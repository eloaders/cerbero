' Gambas module file

Public Sub Main()
If CGI["HTTP_ACCEPT_LANGUAGE"] Like "*ru*" Then
  System.Language = "ru_RU.UTF-8"
Endif
If CGI["HTTP_ACCEPT_LANGUAGE"] Like "*pl*" Then
  System.Language = "pl_PL.UTF-8"
Endif
If CGI["HTTP_ACCEPT_LANGUAGE"] Like "*fr*" Then
  System.Language = "fr_FR.UTF-8"
Endif 
If Request.Get.Exist("search") = True Then
  
Else If Request.Get.Exist("signin") = True Then
  Signs.Sign_in()
Else If Request.Get.Exist("updprofile") = True Then
  CHGProfileDetails.CHProf()
Else If Request.Get.Exist("page") = True Then
  Page.Pages()
Else If Request.Post.Exist("uploadfile") = True Then
  Upload.SendFileToServer()
Else If Request.Get.Exist("validate") = True Then
  MValidate.PrintValidateData()
Else If Request.Get.Exist("fail") = True Then
  PrintFail()
Else If Request.Get.Exist("added") = True Then
  MLatestAdded.Added()
Else If Request.Get.Exist("signup") = True Then
  Signup.Signup()
Else If Request.Get.Exist("login") = True Then
  login.Sign()
Else If Request.Get.Exist("register") = True Then
  Register.Register()
Else If Request.Get.Exist("logout") = True Then
  logout.Remove_Cook()
Else If Request.Get.Exist("profile") = True Then
  Profile.User_Profile()
Else If Request.Get.Exist("chgapi") = True Then
  ChangeAPI_KEYS.CHKeys()
Else If Request.Get.Exist("test") = True Then
  Response.AddHeader("Content-Disposition", "attachment; filename=i-nex-0.6.4-1.1.x86_64.rpm")
  Response.SendFile("/home/michal/Pulpit/i-nex-0.6.4-1.1.x86_64.rpm", "application/x-rpm")
Else If Request.Get.Exist("delvalidate") = True Then
  DelValidate.Delete()
Else
  ResponseFromServer()
Endif
End

Public Sub ResponseFromServer()
  Dim USER_DATA As Collection
    Response.Begin
    'Print Global.ShortURL("http://i-nex.linux.pl/")
    Print File.Load("Upload/Head.html")
    Print "<div class=\"navbar navbar-fixed-top\">"
    Print "   <div class=\"navbar-inner\">"
    Print "     <div class=\"container\">"
    Print "         <a class=\"btn btn-navbar\" data-toggle=\"collapse\" data-target=\".nav-collapse\">"
    Print "           <span class=\"icon-bar\"></span>"
    Print "           <span class=\"icon-bar\"></span>"
    Print "           <span class=\"icon-bar\"></span>"
    Print "         </a>"
    Print "         <a class=\"brand\" href=\"" & Application.Root & "\">"
    Print ("           I-Nex - Cerbero")
    Print "         </a>"
    If IsNull(Request.Cookies["__ursa"]) = False Then

    If Exist(Global.WHEREIS_SITE_ROOT & "/Users/" & Request.Cookies["__ursa"] & "") Then
      USER_DATA = JSON.Decode(File.Load(Global.WHEREIS_SITE_ROOT & "/Users/" & Request.Cookies["__ursa"] & "/Data.json"))
      If USER_DATA["SECRET_KEY"] = Request.Cookies["__apix"] Then
        Print "         <div class=\"nav-collapse\">"
        Print "           <ul class=\"nav pull-right\">"
        Print "             <li class=\"dropdown\">"
        Print "                 <a href=\"#\" class=\"dropdown-toggle\" data-toggle=\"dropdown\">"
        Print "                   <i class=\"icon-user\"></i> "
        Print "                     " & USER_DATA["CERBERO_USERNAME"] & ""
        Print "                   <b class=\"caret\"></b>"
        Print "                 </a>"
        Print "             <ul class=\"dropdown-menu\">"
        Print "                  <li>"
        Print "                    <a href=\"" & Application.Root & "?profile\">"
        Print ("                    Profile")
        Print "                    </a>"
        Print "                  </li>"
        Print "                  <li>"
        Print "                   <a href=\"" & Application.Root & "?logout\">"
        Print ("                   Logout")
        Print "                   </a>"
        Print "                  </li>"
        Print "             </ul>"
        Print "           </li>"
        Print "         </ul>"
        Print "       </div><!--/.nav-collapse -->  "
        Print "    </div> <!-- /container -->"
        Print "</div> <!-- /navbar-inner -->"
      Else
        DUploadUserNav.Render
      Endif
    Else
      DUploadUserNav.Render
    Endif
    Else
      DUploadUserNav.Render
    Endif
    DUploadSubnavbar.Render
    'Carusel.Render
    DUpload.Render
  Response.End
  
End

Public Sub PrintFail()
  
  Response.Begin
  Print File.Load("Error/NotFoundValidateID.html")
  Response.End
  
End

